<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; }
    ul { list-style: none; padding: 0; }
    li { border-bottom: 1px solid #ccc; padding: 0.5rem; }
    button { margin-left: 0.5rem; }
  </style>
</head>
<body>
<h2>Admin Panel</h2>
<div id="userList"></div>
<div id="messageList"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getDatabase, ref, onValue, remove, set } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCUvySwb2nW0pm8D2i70vU6_R0Z6i6gDHY",
    authDomain: "fileupload-3fd69.firebaseapp.com",
    databaseURL: "https://fileupload-3fd69-default-rtdb.firebaseio.com",
    projectId: "fileupload-3fd69",
    storageBucket: "fileupload-3fd69.appspot.com",
    messagingSenderId: "1048191531078",
    appId: "1:1048191531078:web:427c7f65e6637d9a84b247"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  const userList = document.getElementById("userList");
  const messageList = document.getElementById("messageList");

  let users = {}; // uid: email
  let messages = {}; // key: { text, sender, uid }

  onValue(ref(db, "messages"), (snap) => {
    messages = {};
    messageList.innerHTML = "<h3>All Messages</h3><ul>";
    snap.forEach(child => {
      const msg = child.val();
      messages[child.key] = msg;
      messageList.innerHTML += `<li>
        <strong>${msg.sender}:</strong> ${msg.text}
        <button onclick="deleteMessage('${child.key}')">Delete</button>
      </li>`;
      users[msg.uid] = msg.sender;
    });
    messageList.innerHTML += "</ul>";
    renderUsers();
  });

  window.deleteMessage = function(key) {
    if (confirm("Delete this message?")) {
      remove(ref(db, "messages/" + key));
    }
  };

  function renderUsers() {
    userList.innerHTML = "<h3>Users</h3><ul>";
    for (const uid in users) {
      userList.innerHTML += `<li>
        ${users[uid]}
        <button onclick="banUser('${uid}', '${users[uid]}')">Ban</button>
      </li>`;
    }
    userList.innerHTML += "</ul>";
  }

  window.banUser = function(uid, email) {
    const days = prompt(`Ban ${email} for how many days?`);
    if (!days || isNaN(days)) return alert("Invalid duration.");
    const until = Date.now() + days * 24 * 60 * 60 * 1000;
    set(ref(db, "bannedUsers/" + uid), {
      until,
      reason: "Banned by admin for " + days + " days"
    }).then(() => alert(`${email} banned for ${days} day(s).`));
  };
</script>
</body>
</html>
